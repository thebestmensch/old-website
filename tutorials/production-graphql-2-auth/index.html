<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.9.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Production Apollo GraphQL - Authentication &amp; Authorization - James Mensch</title>




<meta name="description" content="Production Apollo GraphQL Series part 2: How to authenticate and authorize users">




<meta name="author" content="James Mensch">

<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="James Mensch">
<meta property="og:title" content="Production Apollo GraphQL - Authentication &amp; Authorization">




  <meta property="og:description" content="Production Apollo GraphQL Series part 2: How to authenticate and authorize users">















  <meta name="twitter:site" content="@thebestmensch">
  <meta name="twitter:title" content="Production Apollo GraphQL - Authentication &amp; Authorization">
  <meta name="twitter:description" content="Production Apollo GraphQL Series part 2: How to authenticate and authorize users">
  <meta name="twitter:url" content="">

  
    <meta name="twitter:card" content="summary">
    
  

  
    <meta name="twitter:creator" content="@James Mensch">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-11-26T00:00:00-06:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "James Mensch",
      "url" : null,
      "sameAs" : null
    }
  </script>







<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="James Mensch Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <!-- <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">James Mensch</a>
        <ul class="visible-links">
          
        </ul>
        
        <button class="greedy-nav__toggle" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div> -->

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.png" alt="James Mensch" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">James Mensch</h3>
    
    
      <p class="author__bio" itemprop="description">
        Building products that make the world a better place. <br/> Director of Engineering @ <a href='http://threatcare.com'>Threatcare</a> <br/> CEO @ <a href='http://magnifai.io'>Magnifai</a>
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Austin, TX</span>
        </li>
      

      

      
        <li>
          <a href="mailto:james@jamesmensch.com">
            <meta itemprop="email" content="james@jamesmensch.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      
        <li>
          <a href="https://keybase.io/jmensch" itemprop="sameAs">
            <i class="fas fa-fw fa-key" aria-hidden="true"></i> Keybase
          </a>
        </li>
      

      
        <li>
          <a href="https://twitter.com/thebestmensch" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/james-mensch" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/jmensch" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Production Apollo GraphQL - Authentication &amp; Authorization">
    <meta itemprop="description" content="NOTE: This example will be using Apollo-Client 1.x and Apollo-Server-Express 1.2.0.">
    <meta itemprop="datePublished" content="November 26, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Production Apollo GraphQL - Authentication &amp; Authorization
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><em>NOTE: This example will be using Apollo-Client 1.x and Apollo-Server-Express 1.2.0.</em></p>

<p><em>This is part two of my Production GraphQL series. Check out part 1, “Essential Setup and Tooling”,</em> <a href="https://blog.cloudboost.io/production-apollo-graphql-essential-setup-and-tooling-4447ac01f94e">here</a>.</p>

<p>Each field provided by a GraphQL Schema corresponds to a resolver that produces the correct field. This gives us unparalleled control over our API, allowing us to govern access by <em>field</em> rather than HTTP endpoint. Let’s dive into how we do that below.</p>

<h2 id="authentication">Authentication</h2>
<p>I prefer JSON Web Tokens for authentication. They’re reusable across all platforms and double as an information exchange. Read more about it <a href="https://jwt.io/introduction/">here</a>.</p>

<p>To use JWT, you need to send it in the Authorization header in each HTTP request, and decrypt it with a secret on the server. Check out this basic example:</p>

<script src="https://gist.github.com/JMensch/c102e651f39f3c4a673322371d2aa4c1.js"></script>

<p>That’s it! When a user with a bad JWT sends a request, your server will return a <code class="highlighter-rouge">401 Unauthorized</code> error.</p>

<h2 id="authorization">Authorization</h2>
<p>GraphQL allows us to define each object’s resolvers, which means we can define who has access to certain objects and object fields. First, let’s update our server to pass the user context to each resolver. Update our previous code to look like this:</p>

<script src="https://gist.github.com/JMensch/e26a43121180ab91b615364541147227.js"></script>

<p>Now the decoded JWT object will be passed to each object and field resolver and mutator:</p>

<script src="https://gist.github.com/JMensch/47b5d0116dee685366bf64ec969a46fe.js"></script>

<p>Now you can perform authorization at the object level, or govern access to individual fields.</p>

<hr />

<p><em>If you enjoyed this article, please help out with a like, a share, or a comment. It fuels my focus to write more of it, thanks!</em></p>

<p>James Mensch is the Director of Engineering at <a href="https://threatcare.com">Threatcare</a> and the CEO at <a href="http://magnifai.io">Magnifai</a>. I believe in building intelligent products, using data to drive decisions, and engineering for social impact. I <a href="https://medium.com/@james_mensch">write</a> about some of the cool stuff I do with tech, productivity and motivation psychology, and my social innovation projects. Connect with me on <a href="https://www.linkedin.com/in/james-mensch/">LinkedIn</a> or say hi on <a href="https://twitter.com/thebestmensch">Twitter</a>.</p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#graphql" class="page__taxonomy-item" rel="tag">graphql</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#javascript" class="page__taxonomy-item" rel="tag">javascript</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#node" class="page__taxonomy-item" rel="tag">node</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#nodejs" class="page__taxonomy-item" rel="tag">nodejs</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#production" class="page__taxonomy-item" rel="tag">production</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#tutorials" class="page__taxonomy-item" rel="tag">tutorials</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-11-26T00:00:00-06:00">November 26, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=thebestmensch&text=Production+Apollo+GraphQL+-+Authentication+%26+Authorization%20%2Ftutorials%2Fproduction-graphql-2-auth%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Ftutorials%2Fproduction-graphql-2-auth%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=%2Ftutorials%2Fproduction-graphql-2-auth%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2Ftutorials%2Fproduction-graphql-2-auth%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/thoughts/perfect-daily-standup/" class="pagination--pager" title="The Perfect Daily Standup
">Previous</a>
    
    
      <a href="/thoughts/2017-reflection/" class="pagination--pager" title="Reflections on 2017
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/thoughts/2018-q1-reading-list/" rel="permalink">My 2018 Q1 Reading List
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Committing to 25 books this year, so that means Q1 2018 should have 6. Here’s what made the cut!

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/thoughts/2017-reflection/" rel="permalink">Reflections on 2017
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">2017 was a year of change. I quit my job, became an entrepreneur, moved from Philadelphia to Austin, overcame challenges and failed at others.
I’ve learned m...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/thoughts/perfect-daily-standup/" rel="permalink">The Perfect Daily Standup
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Regardless of management style or company size, the daily standup has become ubiquitous as an essential tool for every self-organizing team. I’ve both partic...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/tutorials/production-graphql-tooling-1/" rel="permalink">Production Apollo GraphQL - Essential Setup and Tooling
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">GraphQL has revolutionized the way we think about APIs, and Apollo has provided a suite of frameworks to get up and running quick and easy. We’ve been using ...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/thebestmensch"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/jmensch"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 James Mensch. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>








  </body>
</html>